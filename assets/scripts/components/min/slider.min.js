!function(t){var e;window.FatKit&&(e=t(FatKit)),"function"==typeof define&&define.amd&&define("fatkit-slider",["fatkit"],function(){return e||t(FatKit)})}(function(t){"use strict";var e,i,s,n,a={};t.component("slider",{defaults:{center:!1,threshold:10,infinite:!0,fancy:!1,draghandle:!1,activecls:"f-active",nextcls:"f-next",prevcls:"f-previous"},boot:function(){t.ready(function(e){setTimeout(function(){t.$("[data-f-slider]",e).each(function(){var e=t.$(this);e.data("slider")||t.slider(e,t.Utils.options(e.attr("data-f-slider")))})},0)})},init:function(){var h=this;this.container=this.element.find(".f-slider"),this.focus=0,this.options.fancy&&this.container.addClass("f-slider-fancy"),this.options.draghandle&&(this.createHandle(),this.handle=this.slider.handle),t.$win.on("resize load",t.Utils.debounce(function(){h.resize(!0)},100)),this.on("click.fatkit.slider","[data-f-slider-item]",function(e){e.preventDefault();var i=t.$(this).attr("data-f-slider-item");if(h.focus!=i)switch(i){case"next":case"previous":h["next"==i?"next":"previous"]();break;default:h.updateFocus(parseInt(slide,10))}}),this.container.on("touchstart mousedown",function(o){o.button&&2==o.button||!h.active||(s=t.$(o.target).is("a")?t.$(o.target):t.$(o.target).parents("a:first"),n=!1,s.length&&s.one("click",function(t){n&&t.preventDefault()}),i=function(t){n=!0,e=h,a={touchx:parseInt(t.pageX,10),dir:1,focus:h.focus,base:h.options.center?"center":"area"},t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),e.element.data({"pointer-start":{x:parseInt(t.pageX,10),y:parseInt(t.pageY,10)},"pointer-pos-start":h.pos}),h.container.addClass("f-drag"),i=!1},i.x=parseInt(o.pageX,10),i.threshold=h.options.threshold)}),this.resize(!0),this.on("display.f.check",function(){h.element.is(":visible")&&h.resize(!0)}),this.element.find("a,img").attr("draggable","false")},resize:function(){var e,i,s,n=this,a=0,h=0;return this.items=this.container.children(),this.vp=this.element[0].getBoundingClientRect().width,this.container.css({"min-width":"","min-height":""}),this.items.each(function(o){e=t.$(this),s=e.css({left:"",width:""})[0].getBoundingClientRect(),i=s.width,h=Math.max(h,s.height),e.css({left:a,width:i}).data({idx:o,left:a,width:i,area:a+i,center:a-(n.vp/2-i/2)}),a+=i}),this.container.css({"min-width":a,"min-height":h}),this.options.infinite&&a<=2*this.vp&&!this.itemsResized?(this.items.each(function(t){n.container.append(n.items.eq(t).clone(!0).attr("id",""))}),this.items.each(function(t){n.container.append(n.items.eq(t).clone(!0).attr("id",""))}),this.itemsResized=!0,this.resize()):(this.cw=a,this.pos=0,this.active=a>=this.vp,this.container.css({"-ms-transform":"","-webkit-transform":"",transform:""}),this.updateFocus(0),void 0)},createHandle:function(){this.slider=new h(this),this.slider.setup()},updatePos:function(t){this.pos=Math.round(t),this.container.css({"-ms-transform":"translateX("+t+"px)","-webkit-transform":"translateX("+t+"px)",transform:"translateX("+t+"px)"}),this.options.draghandle&&this.updateSliderPos(t)},updateSliderPos:function(t){var e=this.items.eq(0).width()+this.items.eq(1).width(),i=1-t,s=(i+e)/parseFloat(this.container.css("min-width"))*100;s=Math.floor(s/100*this.handle.parent().width()),0>s&&(s=0),this.handle&&this.handle.css({"-ms-transform":"translateX("+s+"px)","-webkit-transform":"translateX("+s+"px)",transform:"translateX("+s+"px)"})},updateFocus:function(t,e){if(this.active){e=e||(t>this.focus?1:-1);var i,s,n=this.items.eq(t);if(this.options.infinite&&this.infinite(t,e),this.options.center)this.updatePos(-1*n.data("center")),this.items.filter("."+this.options.activecls).removeClass(this.options.activecls),n.addClass(this.options.activecls),this.options.fancy&&(this.items.filter("."+this.options.nextcls).removeClass(this.options.nextcls),this.items.filter("."+this.options.prevcls).removeClass(this.options.prevcls),n.next().addClass(this.options.nextcls),n.prev().addClass(this.options.prevcls));else if(this.options.infinite)this.updatePos(-1*n.data("left"));else{for(i=0,s=t;s<this.items.length;s++)i+=this.items.eq(s).data("width");if(i>this.vp)this.updatePos(-1*n.data("left"));else if(1==e){for(i=0,s=this.items.length-1;s>=0;s--)if(i+=this.items.eq(s).data("width"),i>=this.vp){t=s;break}this.updatePos(-1*this.items.eq(t).data("left"))}}this.focus=t,this.trigger("focus.fatkit.slider",[t,this.items.eq(t),this])}},next:function(){var t=this.items[this.focus+1]?this.focus+1:this.options.infinite?0:this.focus;this.updateFocus(t,1)},previous:function(){var t=this.items[this.focus-1]?this.focus-1:this.options.infinite?this.items[this.focus-1]?this.items-1:this.items.length-1:this.focus;this.updateFocus(t,-1)},infinite:function(t,e){var i,s=this,n=this.items.eq(t),a=t,h=[],o=0;if(1==e){for(i=0;i<this.items.length&&(a!=t&&(o+=this.items.eq(a).data("width"),h.push(this.items.eq(a))),!(o>this.vp));i++)a=a+1==this.items.length?0:a+1;h.length&&h.forEach(function(t){var e=n.data("area");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("width")/2)}),n=t})}else{for(i=this.items.length-1;i>-1&&(o+=this.items.eq(a).data("width"),a!=t&&h.push(this.items.eq(a)),!(o>this.vp));i--)a=a-1==-1?this.items.length-1:a-1;h.length&&h.forEach(function(t){var e=n.data("left")-t.data("width");t.css({left:e}).data({left:e,area:e+t.data("width"),center:e-(s.vp/2-t.data("width")/2)}),n=t})}}});var h=function(t){var e=this;this.slider=t,this.wrap=this.slider.element,this.slide_elem=this.wrap.find(".f-slider"),this.sliding=!1,this.slide_items=this.slide_elem.find("li"),this.left_pos=0,this.step=1,this.steps=this.slide_elem.find(">li").length,this.handle_wrap=this.wrap.find(".f-slide-handle"),this.handle=$('<span class="f-drag-handle"></span>'),this.handle_wrap.append(this.handle),this.handle_zero=this.handle.offset().left,this.handle_width=parseFloat(this.handle_wrap.width()),this.single_slide_width=parseInt(this.handle_width/this.steps,10),this.handle.css("width",this.single_slide_width+"px");for(var i=0;i<this.steps;i++){var s=$('<span class="f-slide-step" style="width: '+this.handle_width/this.steps+'px"></span>');s.data("step",i),this.handle_wrap.append(s),s.on("click",function(){var t=$(this).data("step");e.slider.updateFocus(t)})}!function(){var t=function(){e.sliding||(e.sliding=!0,document.ondragstart=this.onselectstart=function(){return!1},document.body.style.MozUserSelect="none",document.body.style.webkitUserSelect="none")},i=function(){e.sliding=!1,this.onselectstart=document.ondragstart=null,document.body.style.MozUserSelect="",document.body.style.webkitUserSelect=""},s=function(t){e.slide(t)};e.handle.on("mousedown touchstart",t),$(document).on("mouseup touchend",i),$(document).on("mousemove touchmove",s)}()};return h.prototype={apply_position:function(){if(this.left_pos<0)return this.left_pos=0,!0;if(this.left_pos>this.slidemax)return this.left_pos=this.slidemax,!0;var t=parseInt(this.handle_width/this.steps*this.step,10),e=1;this.left_pos>t+this.single_slide_width?(this.step=this.step+1,this.slider.element.data("step",this.step),e=1):this.left_pos<t&&(this.step=this.step-1,this.slider.element.data("step",this.step),e=-1);var i=this;return setTimeout(function(){i.slider.updateFocus(i.step,e)},50),this.onSlide.call(this),!1},setup:function(){this.slidemax=this.handle_wrap.width()-this.handle.width(),this.slide_width=this.wrap.width(),this.handle.css("left","0")},slide:function(t){return this.sliding?(t.preventDefault(),this.left_pos=parseInt((t.pageX||t.clientX)-this.handle_wrap.offset().left,10),this.apply_position(),!1):void 0},onSlide:function(){}},t.$doc.on("mousemove.fatkit.slider touchmove.fatkit.slider",function(t){if(t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),i&&Math.abs(t.pageX-i.x)>i.threshold&&(window.getSelection().toString()?e=i=!1:i(t)),e){var s,n,h,o,d,r,l,f,c,p;if(t.clientX||t.clientY?s=t.clientX:(t.pageX||t.pageY)&&(s=t.pageX-document.body.scrollLeft-document.documentElement.scrollLeft),d=a.focus,n=s-e.element.data("pointer-start").x,h=e.element.data("pointer-pos-start")+n,o=s>e.element.data("pointer-start").x?-1:1,r=e.items.eq(a.focus),1==o)for(l=r.data("left")+Math.abs(n),f=0,c=a.focus;f<e.items.length;f++){if(p=e.items.eq(c),c!=a.focus&&p.data("left")<l&&p.data("area")>l){d=c;break}c=c+1==e.items.length?0:c+1}else for(l=r.data("left")-Math.abs(n),f=0,c=a.focus;f<e.items.length;f++){if(p=e.items.eq(c),c!=a.focus&&p.data("area")<=r.data("left")&&p.data("center")<l){d=c;break}c=c-1==-1?e.items.length-1:c-1}e.options.infinite&&d!=a._focus&&e.infinite(d,o),e.updatePos(h),a.dir=o,a._focus=d,a.touchx=parseInt(t.pageX,10),a.diff=l}}),t.$doc.on("mouseup.fatkit.slider touchend.fatkit.slider",function(){if(e){e.container.removeClass("f-drag");var t,s,n,h=(e.items.eq(a.focus),!1);if(1==a.dir)for(s=0,n=a.focus;s<e.items.length;s++){if(t=e.items.eq(n),n!=a.focus&&t.data("left")>a.diff){h=n;break}n=n+1==e.items.length?0:n+1}else for(s=0,n=a.focus;s<e.items.length;s++){if(t=e.items.eq(n),n!=a.focus&&t.data("left")<a.diff){h=n;break}n=n-1==-1?e.items.length-1:n-1}e.updateFocus(h!==!1?h:a._focus),e=i=!1}}),t.slider});