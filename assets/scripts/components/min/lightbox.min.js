!function(i){var t;window.FatKit&&(t=i(FatKit)),"function"==typeof define&&define.amd&&define(["fatkit-lightbox"],function(){return t||i(FatKit)})}(function(i){"use strict";function t(t){return o?(o.lightbox=t,o):(o=i.$(['<div class="f-modal">','<div class="f-modal-dialog f-modal-dialog-lightbox f-slidenav-position" style="margin-left:auto;margin-right:auto;width:200px;height:200px;top:'+Math.abs(window.innerHeight/2-200)+'px;">','<a href="#" class="f-modal-close f-close f-close-alt"></a>','<div class="f-lightbox-content"></div>','<div class="f-modal-spinner f-hidden"></div>',"</div>","</div>"].join("")).appendTo("body"),o.dialog=o.find(".f-modal-dialog:first"),o.content=o.find(".f-lightbox-content:first"),o.loader=o.find(".f-modal-spinner:first"),o.closer=o.find(".f-close.f-close-alt"),o.modal=i.modal(o),o.on("swipeRight swipeLeft",function(i){o.lightbox["swipeLeft"==i.type?"next":"previous"]()}).on("click","[data-lightbox-previous], [data-lightbox-next]",function(t){t.preventDefault(),o.lightbox[i.$(this).is("[data-lightbox-next]")?"next":"previous"]()}),o.on("hide.f.modal",function(){o.content.html("")}),i.$win.on("load resize orientationchange",i.Utils.debounce(function(){o.is(":visible")&&o.lightbox.fitSize()}.bind(this),100)),o.lightbox=t,o)}var o,e={};return i.component("lightbox",{defaults:{group:!1,duration:400,keyboard:!0},index:0,items:!1,boot:function(){i.$html.on("click","[data-f-lightbox]",function(t){t.preventDefault();var o=i.$(this);o.data("lightbox")||i.lightbox(o,i.Utils.options(o.attr("data-f-lightbox"))),o.data("lightbox").show(o)}),i.$doc.on("keyup",function(i){if(o&&o.is(":visible")&&o.lightbox.options.keyboard)switch(i.preventDefault(),i.keyCode){case 37:o.lightbox.previous();break;case 39:o.lightbox.next()}})},init:function(){var t=[];if(this.index=0,this.siblings=[],this.element&&this.element.length){var o=this.options.group?i.$(['[data-f-lightbox*="'+this.options.group+'"]',"[data-f-lightbox*='"+this.options.group+"']"].join(",")):this.element;o.each(function(){var o=i.$(this);t.push({source:o.attr("href"),title:o.attr("title"),type:o.attr("data-lightbox-type")||"auto",link:o})}),this.index=o.index(this.element),this.siblings=t}else this.options.group&&this.options.group.length&&(this.siblings=this.options.group);this.trigger("lightbox-init",[this])},show:function(o){this.modal=t(this),this.modal.dialog.stop(),this.modal.content.stop();var e,n,s=this,h=i.$.Deferred();o=o||0,"object"==typeof o&&this.siblings.forEach(function(i,t){o[0]===i.link[0]&&(o=t)}),0>o?o=this.siblings.length-o:this.siblings[o]||(o=0),n=this.siblings[o],e={lightbox:s,source:n.source,type:n.type,index:o,promise:h,title:n.title,item:n,meta:{content:"",width:null,height:null}},this.index=o,this.modal.content.empty(),this.modal.is(":visible")||(this.modal.content.css({width:"",height:""}).empty(),this.modal.modal.show()),this.modal.loader.removeClass("f-hidden"),h.promise().done(function(){s.data=e,s.fitSize(e)}).fail(function(){alert("Loading resource failed!")}),s.trigger("showitem.f.lightbox",[e])},fitSize:function(){var t=this,o=this.data,e=this.modal.dialog.outerWidth()-this.modal.dialog.width(),n=parseInt(this.modal.dialog.css("margin-top"),10),s=parseInt(this.modal.dialog.css("margin-bottom"),10),h=n+s,a=o.meta.content,d=t.options.duration;this.siblings.length>1&&(a=[a,'<a href="#" class="f-slidenav f-slidenav-contrast f-slidenav-previous f-hidden-touch" data-lightbox-previous></a>','<a href="#" class="f-slidenav f-slidenav-contrast f-slidenav-next f-hidden-touch" data-lightbox-next></a>'].join(""));var l,r,c=i.$("<div>&nbsp;</div>").css({opacity:0,position:"absolute",top:0,left:0,width:"100%","max-width":t.modal.dialog.css("max-width"),padding:t.modal.dialog.css("padding"),margin:t.modal.dialog.css("margin")}),g=o.meta.width,f=o.meta.height;c.appendTo("body").width(),l=c.width(),r=window.innerHeight-h,c.remove(),this.modal.dialog.find(".f-modal-caption").remove(),o.title&&(this.modal.dialog.append('<div class="f-modal-caption">'+o.title+"</div>"),r-=this.modal.dialog.find(".f-modal-caption").outerHeight()),l<o.meta.width&&(f=Math.floor(f*(l/g)),g=l),f>r&&(f=Math.floor(r),g=Math.ceil(o.meta.width*(r/o.meta.height))),this.modal.content.css("opacity",0).width(g).html(a),"iframe"==o.type&&this.modal.content.find("iframe:first").height(f);var m=f+e,u=Math.floor(window.innerHeight/2-m/2)-h;0>u&&(u=0),this.modal.closer.addClass("f-hidden"),t.modal.data("mwidth")==g&&t.modal.data("mheight")==f&&(d=0),this.modal.dialog.animate({width:g+e,height:f+e,top:u},d,"swing",function(){t.modal.loader.addClass("f-hidden"),t.modal.content.css({width:""}).animate({opacity:1},function(){t.modal.closer.removeClass("f-hidden")}),t.modal.data({mwidth:g,mheight:f})})},next:function(){this.show(this.siblings[this.index+1]?this.index+1:0)},previous:function(){this.show(this.siblings[this.index-1]?this.index-1:this.siblings.length-1)}}),i.plugin("lightbox","image",{init:function(i){i.on("showitem.f.lightbox",function(i,t){if("image"==t.type||t.source&&t.source.match(/\.(jpg|jpeg|png|gif|svg)$/)){var o=function(i,o,e){t.meta={content:'<img class="f-responsive-width" width="'+o+'" height="'+e+'" src ="'+i+'">',width:o,height:e},t.type="image",t.promise.resolve()};if(e[t.source])o(t.source,e[t.source].width,e[t.source].height);else{var n=new Image;n.onerror=function(){t.promise.reject("Loading image failed")},n.onload=function(){e[t.source]={width:n.width,height:n.height},o(t.source,e[t.source].width,e[t.source].height)},n.src=t.source}}})}}),i.plugin("lightbox","youtube",{init:function(i){var t=/(\/\/.*?youtube\.[a-z]+)\/watch\?v=([^&]+)&?(.*)/,o=/youtu\.be\/(.*)/;i.on("showitem.f.lightbox",function(i,n){var s,h,a=function(i,t,o){n.meta={content:'<iframe src="//www.youtube.com/embed/'+i+'" width="'+t+'" height="'+o+'" style="max-width:100%;"></iframe>',width:t,height:o},n.type="iframe",n.promise.resolve()};if((h=n.source.match(t))&&(s=h[2]),(h=n.source.match(o))&&(s=h[1]),s){if(e[s])a(s,e[s].width,e[s].height);else{var d=new Image;d.onerror=function(){e[s]={width:640,height:320},a(s,e[s].width,e[s].height)},d.onload=function(){e[s]={width:d.width,height:d.height},a(s,d.width,d.height)},d.src="//img.youtube.com/vi/"+s+"/0.jpg"}i.stopImmediatePropagation()}})}}),i.plugin("lightbox","vimeo",{init:function(t){var o,n=/(\/\/.*?)vimeo\.[a-z]+\/([0-9]+).*?/;t.on("showitem.f.lightbox",function(t,s){var h,a=function(i,t,o){s.meta={content:'<iframe src="//player.vimeo.com/video/'+i+'" width="'+t+'" height="'+o+'" style="width:100%;box-sizing:border-box;"></iframe>',width:t,height:o},s.type="iframe",s.promise.resolve()};(o=s.source.match(n))&&(h=o[2],e[h]?a(h,e[h].width,e[h].height):i.$.ajax({type:"GET",url:"http://vimeo.com/api/oembed.json?url="+encodeURI(s.source),jsonp:"callback",dataType:"jsonp",success:function(i){e[h]={width:i.width,height:i.height},a(h,e[h].width,e[h].height)}}),t.stopImmediatePropagation())})}}),i.plugin("lightbox","video",{init:function(t){t.on("showitem.f.lightbox",function(t,o){var n=function(i,t,e){o.meta={content:'<video class="f-responsive-width" src="'+i+'" width="'+t+'" height="'+e+'" controls></video>',width:t,height:e},o.type="video",o.promise.resolve()};if("video"==o.type||o.source.match(/\.(mp4|webm|ogv)$/))if(e[o.source])n(o.source,e[o.source].width,e[o.source].height);else var s=i.$('<video style="position:fixed;visibility:hidden;top:-10000px;"></video>').attr("src",o.source).appendTo("body"),h=setInterval(function(){s[0].videoWidth&&(clearInterval(h),e[o.source]={width:s[0].videoWidth,height:s[0].videoHeight},n(o.source,e[o.source].width,e[o.source].height),s.remove())},20)})}}),i.lightbox.create=function(t,o){if(t){var e,n=[];return t.forEach(function(t){n.push(i.$.extend({source:"",title:"",type:"auto",link:!1},"string"==typeof t?{source:t}:t))}),e=i.lightbox(i.$.extend({},o,{group:n}))}},i.lightbox});